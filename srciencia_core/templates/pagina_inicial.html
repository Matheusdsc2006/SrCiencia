<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SR. Ciência - Página Inicial</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/pagina_inicial.css' %}">
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <link rel="stylesheet" href="{% static 'css/global-core.css' %}">
</head>
<body>
    <div class="container">
        <!-- Barra Lateral -->
        <aside class="sidebar">
            <div class="logo">
                <img src="{% static 'assets/sr_ciencia.svg' %}" alt="SR. Ciência">
            </div>
            <nav>
                <ul>
                    <li><a href="{% url 'pagina_inicial' %}" class="active"><img src="{% static 'assets/home.svg' %}" alt="">Página inicial</a></li>
                    <li><a href="#"><img src="{% static 'assets/profile.svg' %}" alt="">Meu perfil</a></li>
                    <li><a href="{% url 'questao_list' %}"><img src="{% static 'assets/practice.svg' %}" alt="">Praticar</a></li>
                    <li><a href="{% if user.is_staff %}{% url 'turmas' %}{% else %}{% url 'turmas' %}{% endif %}" class="{% if active_menu == 'turmas' %}active{% endif %}"><img src="{% static 'assets/classes.svg' %}" alt="">Turmas</a></li>
                    <li><a href="#"><img src="{% static 'assets/forum.svg' %}" alt="">Fórum</a></li>
                    <li><a href="#"><img src="{% static 'assets/help.svg' %}" alt="">Ajuda</a></li>
                    <li><a href="{% url 'login' %}" class="logout"><img src="{% static 'assets/logout.svg' %}" alt="">Sair</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Conteúdo Principal -->
        <main>
            <div class="main-container">
                <!-- Header -->
                <div class="header-container">
                    <h1 class="welcome">Bem-vindo, <span class="highlight">Lucas</span></h1>
                    <div class="header-card">
                        <div class="user-info">
                            <div class="user-avatar">
                                <figure>
                                    <img src="{% static 'assets/user.avif' %}" alt="Usuário">
                                </figure>
                            </div>
                            <div>
                                <p class="user-name">{{ user.username }}</p>
                                <p class="user-email">{{ user.email }}</p>
                            </div>
                        </div>
                        <button id="change-account-btn" class="change-account">Mudar de conta</button>
                    </div>
                </div>
                <div class="content-grid">
                    <!-- Coluna Esquerda e Direita -->
                    <!-- Código existente permanece o mesmo -->
                </div>
            </div>
                                                              
            <div class="content-grid">
                <!-- Coluna Esquerda -->
                <section class="left-column">
                    <section class="activities">
                        <section class="pending-items">
                            {% if anexos_pendentes %}
                                <h2>Anexos pendentes</h2>
                                {% for turma in anexos_pendentes %}
                                    <div class="pending-attachments">
                                        <h3>{{ turma.turma }}</h3>
                                        <ul>
                                            {% for anexo in turma.anexos %}
                                                <li data-anexo-id="{{ anexo.id }}">{{ anexo.nome }} - <a href="{{ anexo.url }}" target="_blank">Visualizar</a></li>
                                            {% endfor %}
                                        </ul>
                                        <button class="view-attachments" data-turma-id="{{ turma.id }}">Ver anexos</button>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <h2>Anexos pendentes</h2>
                                <!-- Renderize anexos pendentes aqui -->
                            {% endif %}
                        </section>                        
                    </section>

                    <section class="practicing">
                        <h2>Continuar praticando</h2>
                        <div class="practice-card">
                            <h3>Química II</h3>
                            <p>Pilha de Daniell</p>
                            <p>Sem prazo de entrega</p>
                            <div class="progress-bar">
                                <div class="progress" style="width: 75%;"></div>
                            </div>
                            <button>Continuar tarefa</button>
                        </div>
                    </section>
                </section>

                <!-- Coluna Direita -->
                <aside class="right-column">
                    <section class="daily-goal">
                        <h2>Meta diária</h2>
                        <p>Ganhe 60 pontos</p>
                        <div class="progress-bar">
                            <div class="progress" style="width: 75%;"></div>
                        </div>
                        <p>45/60</p>
                    </section>

                    <section class="ranking">
                        <h2>Ranking Semanal</h2>
                        <ul>
                            <li>1. username - 4012 pontos</li>
                            <li>2. username - 3021 pontos</li>
                            <li>3. username - 2914 pontos</li>
                            <li>4. Lucas - 2845 pontos</li>
                            <li>5. username - 1512 pontos</li>
                        </ul>
                    </section>

                    <section class="announcement">
                        <h2>Anúncio</h2>
                        <div class="ad-placeholder"></div>
                    </section>
                </aside>
            </div>
        </main>
    </div>
<script>
        document.querySelectorAll('.view-attachments').forEach(button => {
        button.addEventListener('click', function() {
            const turmaId = this.getAttribute('data-turma-id');
            const anexosIds = [...this.closest('.pending-attachments').querySelectorAll('li')].map(li => li.dataset.anexoId);

            fetch('/marcar_anexos_vistos/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify({ anexos_ids: anexosIds })
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    alert("Anexos marcados como visualizados.");
                }
            });
        });
    });
</script>
</body>
</html>